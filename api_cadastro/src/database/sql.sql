CREATE DATABASE Yellow_Sensor ;
USE Yellow_Sensor ;

-- ---------------------------------------------------------------------------------------------------------------------------------------------------------
-- Table `cliente`
-- ---------------------------------------------------------------------------------------------------------------------------------------------------------
CREATE TABLE usuario (
  idUsuario INT AUTO_INCREMENT PRIMARY KEY,
  nome VARCHAR(50) ,
  email VARCHAR(70) ,
  senha CHAR(8),
  fkGranja INT,
  FOREIGN KEY (fkGranja) REFERENCES granja(idGranja)
)auto_increment = 100;

-- --------------------------------------------------------------------------------------------------------------------------------------------------------
-- Table `granja`
-- ---------------------------------------------------------------------------------------------------------------------------------------------------------
CREATE TABLE granja (
  idGranja INT AUTO_INCREMENT PRIMARY KEY,
  nome VARCHAR(50),
  estado CHAR(2),
  cnpj CHAR(14),
  cep CHAR(8),
  rua VARCHAR (45),
  bairro VARCHAR(45),
  telefone VARCHAR(20),
  numero_propriedade VARCHAR(4)
);
    
-- ---------------------------------------------------------------------------------------------------------------------------------------------------------
-- TABLE `Yellow_Sensor`.`area`
-- ---------------------------------------------------------------------------------------------------------------------------------------------------------
CREATE TABLE area (
idArea INT PRIMARY KEY AUTO_INCREMENT,
nome_Area VARCHAR(45),
fk_Granja INT,
FOREIGN KEY (fk_Granja) REFERENCES granja(idGranja)
);
-- ---------------------------------------------------------------------------------------------------------------------------------------------------------
-- Table `Yellow_Sensor`.`sensor`
-- ---------------------------------------------------------------------------------------------------------------------------------------------------------
CREATE TABLE sensor (
  idSensor INT AUTO_INCREMENT PRIMARY KEY ,
  fk_Area INT,
  FOREIGN KEY (fk_Area) REFERENCES area (idArea)
);

-- --------------------------------------------------------------------------------------------------------------------------------------------------------
-- Table `registro`
-- ---------------------------------------------------------------------------------------------------------------------------------------------------------

CREATE TABLE registro (
  idRegistro INT PRIMARY KEY  AUTO_INCREMENT,
  diaEhora DATETIME default current_timestamp,
  temperatura FLOAT ,
  alerta VARCHAR(45),
  fk_Sensor INT ,
  FOREIGN KEY (fk_Sensor) REFERENCES sensor(idSensor),
  constraint check_alerta check(alerta='ativado' or alerta='desativado')
);
drop table registro;

select * from  usuario;
select * from  sensor;
select * from  granja;
select * from  registro;
select * from area;

insert into granja(nome, estado, cnpj, cep, rua, bairro, telefone, numero_propriedade) values
	('Granja do Lucas', 'SP', '12312312312312', '09432360', 'Rua Arco Verde', 'Jardim Petr√≥polis', '11999290512', '12');

insert into area(nome_Area, fk_Granja) values
	('Area A', 1),
	('Area B', 1),
	('Area C', 1);
    
insert into sensor(fk_Area) values 
	(1),
    (2),
    (3),
    (1),
    (2);
    
    select round(avg(temperatura),2) from registro;
    
    select round(avg(temperatura),2) from registro 
		join sensor on fk_Sensor = idSensor
        join area on idArea = fk_Area where nome_Area = 'Area B' and day(diaEhora) = day(current_date());
        
	insert into usuario values
		(null, 'Lucas Soares', 'lucas.carvalho@bandtec.com.br', '12345678', null);
        
          select round(avg(temperatura)) as mediaA from registro
	        join sensor on idSensor = fk_sensor
            join area on idArea = fk_Area
            join granja idGranja on fk_Granja
            where fk_Granja = 1 and YEAR(diaEhora) = YEAR(current_date())
            group by MONTH(diaEhora);
    
        INSERT INTO registro(diaEhora,temperatura,alerta,fk_Sensor) 
    VALUES('2021-01-01- 10:00:00',22.5,null,1),
    ('2021-01-02- 10:00:00',14.5,null,2),
    ('2021-01-03- 10:00:00',13.5,null,3),
    ('2021-01-04- 10:00:00',12.5,null,4),
    ('2021-01-05- 10:00:00',11.5,null,5),
    ('2021-01-06- 10:00:00',8.5,null,1),
    ('2021-01-07- 10:00:00',15.5,null,2),
    ('2021-01-08- 10:00:00',16.5,null,3),
    ('2021-01-09- 10:00:00',17.5,null,4),
    ('2021-01-10- 10:00:00',18.5,null,5),
    ('2021-01-11- 10:00:00',19.5,null,1),
    ('2021-01-12- 10:00:00',20.5,null,2),
    ('2021-01-13- 10:00:00',21.5,null,3),
    ('2021-01-14- 10:00:00',9.5,null,4),
    ('2021-01-15- 10:00:00',10.5,null,5),
    ('2021-01-16- 10:00:00',7.5,null,1),
    ('2021-01-17- 10:00:00',11.5,null,2),
    ('2021-01-18- 10:00:00',12.5,null,3),
    ('2021-01-19- 10:00:00',13.5,null,4),
    ('2021-01-20- 10:00:00',14.5,null,5),
    ('2021-01-22- 10:00:00',15.5,null,1),
    ('2021-01-23- 10:00:00',16.5,null,2),
    ('2021-01-24- 10:00:00',17.5,null,3),
    ('2021-01-25- 10:00:00',18.5,null,4),
    ('2021-01-26- 10:00:00',19.5,null,5),
    ('2021-01-27- 10:00:00',20.5,null,1),
    ('2021-01-28- 10:00:00',21.5,null,2),
    ('2021-01-29- 10:00:00',22.5,null,3),
    ('2021-01-30- 10:00:00',23.5,null,4),
    ('2021-01-31- 10:00:00',24.5,null,5),
    ('2021-02-01- 10:00:00',25.5,null,1),
	('2021-02-02- 10:00:00',24.5,null,2),
    ('2021-02-03- 10:00:00',23.5,null,3),
    ('2021-02-04- 10:00:00',22.5,null,4),
    ('2021-02-05- 10:00:00',21.5,null,5),
    ('2021-02-06- 10:00:00',20.5,null,1),
    ('2021-02-07- 10:00:00',19.5,null,2),
    ('2021-02-08- 10:00:00',18.5,null,3),
    ('2021-02-09- 10:00:00',17.5,null,4),
    ('2021-02-10- 10:00:00',16.5,null,5),
    ('2021-02-11- 10:00:00',15.5,null,1),
    ('2021-02-12- 10:00:00',14.5,null,2),
    ('2021-02-13- 10:00:00',13.5,null,3),
    ('2021-02-14- 10:00:00',12.5,null,4),
    ('2021-02-15- 10:00:00',11.5,null,5),
    ('2021-02-16- 10:00:00',10.5,null,1),
    ('2021-02-17- 10:00:00',9.5,null,2),
    ('2021-02-18- 10:00:00',25.5,null,3),
    ('2021-02-19- 10:00:00',24.5,null,4),
    ('2021-02-20- 10:00:00',23.5,null,5),
    ('2021-02-21- 10:00:00',22.5,null,1),
    ('2021-02-22- 10:00:00',21.5,null,2),
    ('2021-02-23- 10:00:00',20.5,null,3),
    ('2021-02-24- 10:00:00',19.5,null,4),
    ('2021-02-25- 10:00:00',18.5,null,5),
    ('2021-02-26- 10:00:00',17.5,null,1),
    ('2021-02-27- 10:00:00',16.5,null,2),
    ('2021-02-28- 10:00:00',15.5,null,3),
    ('2021-03-01- 10:00:00',14.4,null,4),
    ('2021-03-02- 10:00:00',13.4,null,5),
    ('2021-03-03- 10:00:00',12.4,null,1),
    ('2021-03-04 10:00:00',11.4,null,2),
    ('2021-03-05- 10:00:00',10.4,null,3),
    ('2021-03-06- 10:00:00',9.4,null,4),
    ('2021-03-07- 10:00:00',8.4,null,5),
    ('2021-03-08- 10:00:00',25.4,null,1),
    ('2021-03-09- 10:00:00',24.4,null,2),
    ('2021-03-10- 10:00:00',23.4,null,3),
    ('2021-03-11- 10:00:00',21.4,null,4),
    ('2021-03-12- 10:00:00',20.4,null,5),
    ('2021-03-13- 10:00:00',19.4,null,1),
    ('2021-03-14- 10:00:00',18.4,null,2),
    ('2021-03-15- 10:00:00',17.4,null,3),
    ('2021-03-16- 10:00:00',16.4,null,4),
    ('2021-03-17- 10:00:00',15.4,null,5),
    ('2021-03-18- 10:00:00',14.4,null,1),
    ('2021-03-19- 10:00:00',13.4,null,2),
    ('2021-03-20- 10:00:00',12.4,null,3),
    ('2021-03-21- 10:00:00',11.4,null,4),
    ('2021-03-22- 10:00:00',10.4,null,5),
    ('2021-03-23- 10:00:00',9.4,null,1),
    ('2021-03-24- 10:00:00',8.4,null,2),
    ('2021-03-25- 10:00:00',25.4,null,3),
    ('2021-03-26- 10:00:00',24.4,null,4),
    ('2021-03-27- 10:00:00',23.4,null,5),
    ('2021-03-28- 10:00:00',22.4,null,1),
    ('2021-03-29- 10:00:00',21.4,null,2),
    ('2021-04-30- 10:00:00',21,null,1),
    ('2021-05-20- 10:00:00',10.5,null,1),
    ('2021-05-20- 10:00:00',18.5,null,1),
    ('2021-06-20- 10:00:00',13.5,null,1),
    ('2021-06-20- 10:00:00',12,null,1),
    ('2021-07-20- 10:00:00',22.4,null,1),
    ('2021-07-20- 10:00:00',21,null,1),
    ('2021-08-20- 10:00:00',32.5,null,1),
    ('2021-08-20- 10:00:00',30.5,null,1),
    ('2021-09-20- 10:00:00',38.5,null,1),
    ('2021-09-20- 10:00:00',13.5,null,1),
    ('2021-10-20- 10:00:00',32,null,1),
    ('2021-10-20- 10:00:00',42.4,null,1),
    ('2021-10-20- 10:00:00',31,null,1),
    ('2021-11-20- 10:00:00',12.5,null,1),
    ('2021-11-10- 10:00:00',29.5,null,1)
    ;